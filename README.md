# The world factbook data representation

### Task

- Choose 4 states from [The world factbook](https://www.cia.gov/the-world-factbook/) and represent them in XML.
- Create DTD and RelaxNG schema for the validation structure of your XML documents.
- Using XSLT generate HTML outputs (a single page for each state and one index, which contains links to all pages)
- create a navigation menu for every subpage, using CSS
- Use XSL-FO for generating PDF output (single pdf for every state and one, which contains all states), add header, footer, and page numbers.
- add pictures of maps and flags to HTML and PDF output

### Project structure

```
src
├── author
├── DTDConcatenation
├── fop
├── generatedPdf
├── generatedWeb
│ ├── css
│ ├── html
│ └── javaScript
├── generatedXML
├── htmlParser
├── htmlSourceData
├── images
│ ├── flags
│ └── maps
├── saxon
├── scripts
├── validators
├── xslfo
└── xslt
```

- folder **author** contains information about the author in XML format
- folder **DTDConcatenation** contains a DTD file, which concatenates all generated XML files into one
- folder **fop** contains software [Fop 2.6](https://xmlgraphics.apache.org/fop/) for converting fo files into pdf
- folder **generatedPdf** contains generated pdf files, which can be generated by scripts
- folder **generatedWeb** can be generated by scripts
  - **HTML** folder, where are all generated HTML files of web
- folder **generatedXML** contains XML files representing states, which can be generated by scripts
- folder **htmlParser** contains Nodejs program, which parses htmlData and create XML representation of them
- folder **htmlSourceData** contains HTML pages downloaded from [The world factbook](https://www.cia.gov/the-world-factbook/), source files for HTML parser
- folder **images** contains images used by web and pdf
- folder **saxon** contains jar files - software [Saxon home edition 10.3](https://www.saxonica.com/documentation/documentation.xml)
- folder **scripts** contains bash scripts for generating and validating files
- folder **validators** contains DTD and RelaxNG validation schemas
- folder **xslfo** contains fo files for generating pdf, can be generated by scripts
- folder **xslt** contains XSLT stylesheets for transforming XML files into HTML and fo files

### Software requirements

- [Linux](https://ubuntu.com/) - all scripts run in bash
- [Nodejs](https://nodejs.org/en/) - runtime for JavaScript - used by HTML parser
- [Npm](https://www.npmjs.com/) - package manager - should be part of nodejs
- [xmllint](http://xmlsoft.org/xmllint.html) - used for DTD validation, default tool on many Linux distributions
- [trang](https://relaxng.org/jclark/trang.html) - used for generating a rng file from rnc
- [Java](https://www.java.com/en/) - used by Saxon (XSLT processor)

### Run all (following) steps at once

- use bash script for generation and validation files
- run all commands from the project root directory
- make all scripts executable `chmod +x src/scripts/*`
- run script `src/scripts/runAll.sh`
- if some XML file is not valid, run the script again, it will recreate files and delete old invalid files

### Running steps separately

- **run steps in the following order**, steps are dependent on previous steps!

### Generating XML files

- program htmlParser converts HTML files downloaded from the internet to XML files
- written in javascript, run by Nodejs
- program will create src/generatedXML folder, if it does not exist yet. If it exists, folder will be deleted and recreated!
- program HTML sources are in src/htmlSourceData
- this step needs software [Nodejs](https://nodejs.org/en/) and [npm](https://www.npmjs.com/) package manager
- run all commands from the project root directory
- **automatic generating using bash script**
  - make script executable `chmod +x src/scripts/generateXML.sh`
  - run script `src/scripts/generateXML.sh`
- **manual generating**
  - go to folder `cd src/htmlParser`
  - download dependencies `npm install` (this will download dependencies defined in package.json)
  - start program `node main.js`

### Validating XML files

##### DTD validation

- DTD schema is in src/validators/stateType.dtd
- before this, you have to generate XML files, which you want to validate (previous step)
- this step needs software [xmllint](http://xmlsoft.org/xmllint.html)
- run all commands from the project root directory
- **automatic validation of all states using bash script**
  - make script executable `chmod +x src/scripts/validateDTD.sh`
  - run script `src/scripts/validateDTD.sh`
- **manual validation of individual states**
  - validate state, replace `<xml file>` with the file you want to evaluate `xmllint --noout --dtdvalid src/validators/stateType.dtd src/generatedXML/<xml file>`

##### RelaxNG validation

- RelaxNG grammar is in src/validators/stateType.rnc
- before this, you have to generate the XML file, which you want to validate
- this step needs software [trang](https://relaxng.org/jclark/trang.html) and [xmllint](http://xmlsoft.org/xmllint.html)
- run all commands from the project root directory
- **automatic validation of all states using bash script**
  - make script executable `chmod +x src/scripts/validateRelaxNG.sh`
  - run script `src/scripts/validateRelaxNG.sh`
- **manual validation of individual states**
  - generate rng file `trang src/validators/stateType.rnc src/validators/stateType.rng`
  - validate state, replace `<xml file>` with the file you want to evaluate `xmllint --noout --relaxng src/validators/stateType.rng src/generatedXML/<xml file>`

### Concatenation generated files into one

- DTD definition of the concatenated file is in src/DTDConcatenation/concatenatedXML.xml
- the result file is src/generatedXML/concatenated.xml
- this step needs software [xmllint](http://xmlsoft.org/xmllint.html)
- run all commands from the project root directory
- **automatic concatenation using bash script**
  - make script executable `chmod +x src/scripts/concatenateStates.sh`
  - run script `src/scripts/concatenateStates.sh`
- **manual concatenation**
  - `xmllint --noent src/DTDConcatenation/concatenateXML.xml > src/generatedXML/concatenated.xml`

### Generating HTML files

- HTML files are generated from XML files in src/generatedXML using XSLT style sheets src/xslt/htmlHomePage.xsl and src/xslt/htmlSateStyle.xsl
- generated files will be in src/generatedWeb/html
- this step needs software [Java](https://www.java.com/en/)
- run all commands from the project root directory
- **automatic generation using bash script**
  - make script executable `chmod +x src/scripts/generateWeb.sh`
  - run script `src/scripts/generateWeb.sh`
- **manual generation**
  - make a directory for output `mkdir -p src/generatedWeb/html > /dev/null 2>&1`
  - generate index `java -jar src/saxon/saxon-he-10.3.jar src/generatedXML/concatenated.xml src/xslt/htmlHomePageStyle.xsl > src/generatedWeb/html/index.html`
  - generate states `java -jar src/saxon/saxon-he-10.3.jar src/generatedXML/<state>.xml src/xslt/htmlStateStyle.xsl > src/generatedWeb/html/<state>.html` don't forget to replace `<state>` by name of state e.g. france, germany...

### Generating PDF files

- pdf files are generated from src/xslfo/\*.fo files
- src/xslfo/\*.fo files are generated from XML files in src/generatedXML using src/xslt/pdf\*.xsl stylesheets
- generated pdf files will be in src/generatedPdf
- this step uses fop software, which I included in src/fop
- run all commands from the project root directory
- **automatic generation using bash script**
  - make script executable `chmod +x src/scripts/generatePdf.sh`
  - run script `src/scripts/generatePdf.sh`
- **manual generation**
- create output directories `mkdir -p src/generatedPdf > /dev/null 2>&1` `mkdir -p src/xslfo > /dev/null 2>&1`
- generate fo file from all states `java -jar src/saxon/saxon-he-10.3.jar src/generatedXML/concatenated.xml src/xslt/pdfAllStatesStyle.xsl > src/xslfo/allStates.fo`
- generate fo file for single state `java -jar src/saxon/saxon-he-10.3.jar src/generatedXML/<state>.xml src/xslt/pdfStateStyle.xsl > src/xslfo/<state>.fo`, replace `<state>` by state name
- generate pdf file from all states `src/fop/fop/fop src/xslfo/allStates.fo src/generatedPdf/allStates.pdf`
- generate pdf file from single state `src/fop/fop/fop src/xslfo/<state>.fo src/generatedPdf/<state>.pdf`, replace `<state>` by state name

### Sources

http://saxon.sourceforge.net/ <br/>
https://relaxng.org/jclark/trang.html <br/>
https://relaxng.org/compact-tutorial-20030326.html <br/>
https://www.w3schools.com/xml/default.asp <br/>
https://www.w3schools.com/xml/xpath_intro.asp <br/>
https://www.w3schools.com/xml/xsl_intro.asp <br/>
https://www.w3schools.com/xml/xml_dtd_intro.asp <br/>
http://zvon.org/comp/r/tut-XSLT_1.html <br/>
https://www.youtube.com/watch?v=W--Yhp0m35A <br/>
https://www.youtube.com/watch?v=D2YzF4hm9NM <br/>
https://undraw.co/illustrations <br/>
https://fonts.google.com/ <br/>
https://fontawesome.com/account <br/>
https://w3schools.sinsixx.com/xslfo/xslfo_lists.asp.htm <br/>
https://xmlgraphics.apache.org/fop/<br/>
https://www.kosek.cz/xml/schema/rng.html
